<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: timed-metric.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: timed-metric.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const Settings = require('./settings');

/**
 * Implements a metric that can timeout or be cancelled.
 *
 * TimedMetric extends Promise. This way, when the metric times out, it resolve. When,
 * however, the metric is cancelled it rejects.
 * @class
 */
class TimedMetric extends Promise {
  value;
  #reject;
  #resolve;
  #timeout;

  static get [Symbol.species]() {
    return Promise;
  }

  get [Symbol.toStringTag]() {
    return 'TimedMetric';
  }

  constructor(metric) {
    var resolve;
    var reject;

    /* Getting the resolve and reject callbacks */
    super((_resolve, _reject) => {
      reject = _reject;
      resolve = _resolve;
    });

    this.#init(resolve, reject, metric);
  }

  #init = (resolve, reject, metric) => {
    this.#reject = reject;
    this.#resolve = resolve;
    this.value = Math.round(metric.value);
    this.#timeout = setTimeout(() => this.#resolve(), Settings.StorageTimeout);
  };

  /**
   * Cancels the timed metric.
   *
   * When invoked, this method clears the timeout associated with the metric and, since the metric
   * is a promise, rejects it.
   * @method
   */
  cancel() {
    clearTimeout(this.#timeout);
    this.#reject(new Error('Aborted'));
  }
}

module.exports = TimedMetric;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Store.html">Store</a></li><li><a href="TimedMetric.html">TimedMetric</a></li><li><a href="TimedMetricsQueue.html">TimedMetricsQueue</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.6</a> on Wed Feb 17 2021 12:37:22 GMT+0100 (West Africa Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
